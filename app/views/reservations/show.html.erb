<% @page_title = "予約詳細" %>
<h1>予約詳細</h1>

<div class="completion-box">
    <div class="status-display" style="margin-bottom: 15px; font-weight: bold;">
        現在のステータス: 
        <span class="status-<%= @reservation.status %>">
            <% case @reservation.status
                when 'pending' then '未定'
                when 'approved' then '承諾'
                when 'rejected' then '却下'
                when 'completed' then '完了'
                end %>
        </span>
    </div>

    <table class="attr">
        <tr>
            <th>予約番号</th>
            <td><%= @reservation.id %></td>
        </tr>
        <tr>
            <th>
                <% if @reservation.member_id == current_member.id %>
                    予約相手（特別会員）
                <% else %>
                    予約者
                <% end %>
            </th>
            <td>
                <% if @reservation.member_id == current_member.id %>
                    <%= @reservation.target_member.name %> さん
                <% else %>
                    <%= @reservation.member.name %> さん
                <% end %>
            </td>
        </tr>
        <tr>
            <th>日時</th>
            <td>
                <%= @reservation.start_at.strftime("%Y年%m月%d日 %H:%M") %> 〜 
                <%= @reservation.end_at.strftime("%H:%M") %>
            </td>
        </tr>
        <tr>
            <th>利用時間</th>
            <td><%= @reservation.hours %> 時間</td>
        </tr>
        <tr>
            <th>合計金額</th>
            <td>
                <% total_price = @reservation.hours * @reservation.target_member.price_per_hour %>
                <%= number_with_delimiter(total_price) %> 円
            </td>
        </tr>
    </table>

<div class="action-buttons" style="margin-top: 20px;">
    <% if current_member.id == @reservation.target_member_id %>
        
        <% if @reservation.pending? %>
        <div style="display: flex; gap: 10px;">
            <%= button_to "承諾する", update_status_reservation_path(@reservation, status: 'approved'), method: :patch, class: "btn-primary", form: { data: { turbo_confirm: "承諾しますか？" } } %>
            <%= button_to "却下する", update_status_reservation_path(@reservation, status: 'rejected'), method: :patch, class: "btn-danger", form: { data: { turbo_confirm: "却下しますか？" } } %>
        </div>

        <% elsif @reservation.approved? %>
        <div class="status-message" style="margin-bottom: 10px; color: green; font-weight: bold;">
            現在「承諾」しています。
        </div>
        <%= button_to "承諾を取り消す", update_status_reservation_path(@reservation, status: 'pending'), method: :patch, class: "btn-secondary" %>

        <% elsif @reservation.rejected? %>
        <div class="status-message" style="margin-bottom: 10px; color: red; font-weight: bold;">
            現在「却下」しています。
        </div>
        <%= button_to "却下を取り消す", update_status_reservation_path(@reservation, status: 'pending'), method: :patch, class: "btn-secondary" %>
        
        <% end %>

    <% end %>
</div>

    <div class="actions" style="margin-top: 20px;">
        <%= link_to "予約一覧へ戻る", reservations_path %> | 
        <%= link_to "トップページへ", root_path %>
    </div>
</div>