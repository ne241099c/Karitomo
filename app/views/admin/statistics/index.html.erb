<% @page_title = "統計情報" %>
<h1><%= @page_title %></h1>

<div class="admin-statistics">
	<!-- 会員統計 -->
	<section class="stats-section">
		<h2>会員統計</h2>
		<div class="stats-grid">
			<div class="stat-card stat-card-blue">
				<h3>総会員数</h3>
				<p class="stat-number"><%= @total_members %> 名</p>
			</div>
			<div class="stat-card">
				<h3>男性会員</h3>
				<p class="stat-number"><%= @male_members %> 名</p>
			</div>
			<div class="stat-card">
				<h3>女性会員</h3>
				<p class="stat-number"><%= @female_members %> 名</p>
			</div>
			<div class="stat-card stat-card-orange">
				<h3>スペシャル会員</h3>
				<p class="stat-number"><%= @special_members %> 名</p>
			</div>
			<div class="stat-card stat-card-red">
				<h3>BAN済み会員</h3>
				<p class="stat-number"><%= @banned_members %> 名</p>
			</div>
		</div>
	</section>

	<!-- 予約統計 -->
	<section class="stats-section">
		<h2>予約統計</h2>
		<div class="stats-grid">
			<div class="stat-card stat-card-blue">
				<h3>総予約数</h3>
				<p class="stat-number"><%= @total_reservations %> 件</p>
			</div>
			<div class="stat-card">
				<h3>承認待ち</h3>
				<p class="stat-number"><%= @pending_reservations %> 件</p>
			</div>
			<div class="stat-card stat-card-green">
				<h3>承認済み</h3>
				<p class="stat-number"><%= @approved_reservations %> 件</p>
			</div>
			<div class="stat-card stat-card-blue">
				<h3>完了</h3>
				<p class="stat-number"><%= @completed_reservations %> 件</p>
			</div>
			<div class="stat-card">
				<h3>拒否</h3>
				<p class="stat-number"><%= @rejected_reservations %> 件</p>
			</div>
			<div class="stat-card stat-card-red">
				<h3>キャンセル</h3>
				<p class="stat-number"><%= @canceled_reservations %> 件</p>
			</div>
			<div class="stat-card stat-card-orange">
				<h3>今月の予約</h3>
				<p class="stat-number"><%= @this_month_reservations %> 件</p>
			</div>
			<div class="stat-card">
				<h3>今週の予約</h3>
				<p class="stat-number"><%= @this_week_reservations %> 件</p>
			</div>
		</div>
	</section>

	<!-- 売上統計 -->
	<section class="stats-section">
		<h2>売上統計</h2>
		<div class="stats-grid">
			<div class="stat-card stat-card-green">
				<h3>総売上（完了済み）</h3>
				<p class="stat-number">¥<%= number_with_delimiter(@total_revenue) %></p>
			</div>
			<div class="stat-card stat-card-orange">
				<h3>今月の売上</h3>
				<p class="stat-number">¥<%= number_with_delimiter(@this_month_revenue) %></p>
			</div>
		</div>
	</section>

	<!-- レビュー統計 -->
	<section class="stats-section">
		<h2>レビュー統計</h2>
		<div class="stats-grid">
			<div class="stat-card stat-card-blue">
				<h3>総レビュー数</h3>
				<p class="stat-number"><%= @total_reviews %> 件</p>
			</div>
			<div class="stat-card stat-card-green">
				<h3>平均評価スコア</h3>
				<p class="stat-number"><%= @average_score %> / 5.0</p>
			</div>
		</div>
	</section>

	<!-- その他の統計 -->
	<section class="stats-section">
		<h2>その他の統計</h2>
		<div class="stats-grid">
			<div class="stat-card">
				<h3>タグ数</h3>
				<p class="stat-number"><%= @total_tags %> 件</p>
			</div>
			<div class="stat-card">
				<h3>地域数</h3>
				<p class="stat-number"><%= @total_regions %> 件</p>
			</div>
			<div class="stat-card">
				<h3>ブロック数</h3>
				<p class="stat-number"><%= @total_blocks %> 件</p>
			</div>
			<div class="stat-card">
				<h3>ブックマーク数</h3>
				<p class="stat-number"><%= @total_bookmarks %> 件</p>
			</div>
			<div class="stat-card">
				<h3>総お問い合わせ</h3>
				<p class="stat-number"><%= @total_contacts %> 件</p>
			</div>
			<div class="stat-card">
				<h3>今月のお問い合わせ</h3>
				<p class="stat-number"><%= @this_month_contacts %> 件</p>
			</div>
			<div class="stat-card stat-card-red">
				<h3>総通報数</h3>
				<p class="stat-number"><%= @total_reports %> 件</p>
			</div>
			<div class="stat-card stat-card-orange">
				<h3>今月の通報</h3>
				<p class="stat-number"><%= @this_month_reports %> 件</p>
			</div>
			<div class="stat-card">
				<h3>総チャット数</h3>
				<p class="stat-number"><%= @total_chats %> 件</p>
			</div>
			<div class="stat-card">
				<h3>今月のチャット</h3>
				<p class="stat-number"><%= @this_month_chats %> 件</p>
			</div>
		</div>
	</section>

	<!-- 人気スペシャル会員TOP5 -->
	<section class="stats-section">
		<h2>人気スペシャル会員 TOP5</h2>
		<div class="table-container">
			<table class="list">
				<thead>
					<tr>
						<th>順位</th>
						<th>名前</th>
						<th>予約数</th>
						<th>時給</th>
					</tr>
				</thead>
				<tbody>
					<% @top_special_members.each.with_index(1) do |member, index| %>
						<tr>
							<td><%= index %></td>
							<td><%= link_to member.name, admin_member_path(member) %></td>
							<td><%= member.reservations_count %> 件</td>
							<td>¥<%= number_with_delimiter(member.price_per_hour) %></td>
						</tr>
					<% end %>
					<% if @top_special_members.empty? %>
						<tr>
							<td colspan="4" style="text-align: center;">データがありません</td>
						</tr>
					<% end %>
				</tbody>
			</table>
		</div>
	</section>

	<!-- 人気タグTOP5 -->
	<section class="stats-section">
		<h2>人気タグ TOP5</h2>
		<div class="table-container">
			<table class="list">
				<thead>
					<tr>
						<th>順位</th>
						<th>タグ名</th>
						<th>使用者数</th>
					</tr>
				</thead>
				<tbody>
					<% @top_tags.each.with_index(1) do |tag, index| %>
						<tr>
							<td><%= index %></td>
							<td><%= tag.name %></td>
							<td><%= tag.usage_count %> 名</td>
						</tr>
					<% end %>
					<% if @top_tags.empty? %>
						<tr>
							<td colspan="3" style="text-align: center;">データがありません</td>
						</tr>
					<% end %>
				</tbody>
			</table>
		</div>
	</section>
</div>

<div class="actions">
	<%= link_to "管理TOPへ戻る", admin_root_path, class: "btn-secondary" %>
</div>

<style>
.admin-statistics {
	padding: 20px 0;
}

.stats-section {
	margin-bottom: 40px;
	background: #fff;
	padding: 20px;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stats-section h2 {
	margin-bottom: 20px;
	padding-bottom: 10px;
	border-bottom: 2px solid #ddd;
	color: #333;
}

.stats-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
	gap: 20px;
}

.stat-card {
	background: #f9f9f9;
	padding: 20px;
	border-radius: 8px;
	text-align: center;
	border: 1px solid #e0e0e0;
	transition: transform 0.2s;
}

.stat-card:hover {
	transform: translateY(-2px);
	box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.stat-card h3 {
	font-size: 14px;
	color: #666;
	margin-bottom: 10px;
	font-weight: normal;
}

.stat-card .stat-number {
	font-size: 28px;
	font-weight: bold;
	color: #333;
	margin: 0;
}

.stat-card-blue {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: white;
	border: none;
}

.stat-card-blue h3,
.stat-card-blue .stat-number {
	color: white;
}

.stat-card-green {
	background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
	color: white;
	border: none;
}

.stat-card-green h3,
.stat-card-green .stat-number {
	color: white;
}

.stat-card-orange {
	background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
	color: white;
	border: none;
}

.stat-card-orange h3,
.stat-card-orange .stat-number {
	color: white;
}

.stat-card-red {
	background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
	color: white;
	border: none;
}

.stat-card-red h3,
.stat-card-red .stat-number {
	color: white;
}

.table-container {
	overflow-x: auto;
}

.table-container table {
	width: 100%;
	background: white;
}

.table-container th {
	background: #f5f5f5;
	font-weight: bold;
}

@media (max-width: 768px) {
	.stats-grid {
		grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
	}
	
	.stat-card .stat-number {
		font-size: 22px;
	}
}
</style>
