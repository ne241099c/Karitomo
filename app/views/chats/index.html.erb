<% @page_title = "チャットルーム" %>
<h1>チャットルーム</h1>

<div class="chat-info">
	<p>
		<strong>予約相手:</strong> 
		<% if @reservation.member_id == current_member.id %>
			<%= @reservation.target_member.name %> さん
		<% else %>
			<%= @reservation.member.name %> さん
		<% end %>
	</p>
</div>

<div class="mb-20">
	<strong>予約日時:</strong> 
	<%= @reservation.start_at.strftime("%Y/%m/%d %H:%M") %> 〜 
	<%= @reservation.end_at.strftime("%H:%M") %>
</div>

<div class="chat-section">
	<div id="chat-messages" class="chat-history"
		data-reservation-id="<%= @reservation.id %>"
		data-current-user-id="<%= current_member.id %>">
		
		<% @chats.each do |chat| %>
			<div class="chat-message <%= chat.member_id == current_member.id ? 'chat-message-right' : 'chat-message-left' %>">
				<div class="chat-meta"><%= chat.member.name %> (<%= chat.created_at.strftime("%H:%M") %>)</div>
				<div class="chat-bubble <%= chat.member_id == current_member.id ? 'chat-bubble-right' : 'chat-bubble-left' %>">
					<%= chat.content %>
				</div>
			</div>
		<% end %>
  	</div>

	<%= form_with model: [@reservation, @chat], local: true, id: "chat-form" do |f| %>
		<%= render "shared/error_messages", object: f.object %>
		<div class="d-flex gap-10">
			<%= f.text_field :content, id: "chat-input", class: "field-col", placeholder: "メッセージを入力" %>
			<%= f.submit "送信", class: "btn-primary" %>
		</div>
  <% end %>
</div>

<div class="actions">
  	<%= link_to "予約詳細に戻る", reservation_path(@reservation) %> |
  	<%= link_to "予約一覧に戻る", reservations_path %>
</div>
